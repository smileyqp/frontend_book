ä¸»è¦æ˜¯æ ¹æ®è‡ªå·±æ²¡æœ‰æŒæ¡å¥½ä»¥åŠè¿˜æ²¡æœ‰äº†è§£çš„éƒ¨åˆ†è¿›è¡Œè¡¥å……ã€‚[githubåœ°å€](https://github.com/smileyqp/frontend_book/blob/master/%E5%88%86%E5%9D%97%E5%A4%8D%E4%B9%A0%E6%9F%A5%E6%BC%8F%E8%A1%A5%E7%BC%BA.md)ã€‚githubä¼šå®æ—¶æ›´æ–°ï¼Œå¯ä»¥ä¸‹è½½ç”¨markdownæŸ¥çœ‹ã€‚

> å…³äºç¢ç¢å¿µï¼šé•¿æœŸå·¥ä½œä»¥æ¥ï¼Œæœ‰äº›ä¸œè¥¿æ¯”å¦‚react fiberã€react hooksè¿™äº›å…¶å®éƒ½å¬è¿‡ï¼Œä½†æ˜¯ç”±äºå·¥ä½œä¸Šä½¿ç”¨åœºæ™¯æ¯”è¾ƒæœ‰é™ï¼Œä»¥åŠä¸ªäººç²¾åŠ›æœ‰é™ç­‰åŸå› ï¼Œæ²¡æœ‰è¯¦ç»†å»äº†è§£å…¶ä¸­åŸç†ã€‚è¿™æ¬¡æŸ¥æ¼è¡¥ç¼ºçš„æ—¶å€™ï¼Œå»çœ‹äº†ä¸€ä¸‹fiberã€diffä»¥åŠhooksç­‰ï¼Œåœ¨å®ƒä»¬äº§ç”Ÿçš„åŸå› èƒŒæ™¯ã€è§£å†³äº†å“ªäº›å®é™…é—®é¢˜ã€åœ¨å‰ç«¯çš„å“ªäº›æ–¹é¢è¿›è¡Œäº†ä¼˜åŒ–ã€ä»¥åŠç®€å•çš„å®ç°æ–¹å¼ç­‰æ–¹é¢è¿›è¡Œäº†äº†è§£ä¹‹åï¼Œç¡®å®è§‰å¾—åœ¨ä¸€å®šç¨‹åº¦ä¸Šè®©è‡ªå·±å¯¹å‰ç«¯çš„æŠ€æœ¯å‘å±•ï¼Œå‰ç«¯çš„ä¼˜åŒ–ç­‰æ–¹é¢æœ‰äº†æ›´æ·±å±‚æ¬¡çš„æ€è€ƒã€‚ä¹Ÿç¡®å®æœ‰æ„æ€ï¼smileyqpç»§ç»­åŠ æ²¹å‘€ï¼

[TOC]

#### 1ã€requireå’Œimportçš„åŒºåˆ«

- è§„èŒƒï¼šrequireæ˜¯nodeçš„commonjsè§„èŒƒï¼›importæ˜¯ES6çš„æ¨¡å—åŒ–è§„èŒƒ
- å¯å¦åŠ¨æ€ï¼šrequireæ”¯æŒåŠ¨æ€å¯¼å…¥ï¼›importä¸æ”¯æŒåŠ¨æ€å¯¼å…¥
- å¯¼å…¥æ–¹å¼ï¼šrequireè¾“å‡ºçš„æ˜¯ä¸€ä¸ªå€¼çš„æ‹·è´ï¼›importè¾“å‡ºçš„æ˜¯ä¸€ä¸ªå€¼çš„å¼•ç”¨
- ä½ç½®ï¼šimportå¯ä»¥åœ¨importæ¨¡å—å¼•å…¥ä¹‹å‰ä½¿ç”¨ï¼Œä½†æ˜¯requireåªèƒ½åœ¨å¼•ç”¨ä¹‹åä½¿ç”¨
- æ˜¯å¦å¯ä»¥åœ¨æ¨¡å—ä¸­ä½¿ç”¨ï¼šimportä¸å¯ä»¥åœ¨ä»£ç å—ä¸­å¼•ç”¨ï¼Œåªèƒ½åœ¨æ¨¡å—é¡¶å±‚ä½¿ç”¨ï¼›ä½†æ˜¯requireå¯ä»¥åœ¨ä»£ç å—ä¸­ä½¿ç”¨

## 7.16 

#### 2ã€webpackå’Œbabel

[webpackåŸºç¡€å¿…å¤‡çš„çŸ¥è¯†ç‚¹xmindæ ¼å¼](https://github.com/smileyqp/frontend_book/blob/master/webpack.xmind)

##### 1ã€ä¸ºä»€ä¹ˆè¦ä½¿ç”¨

- ES6æ¨¡å—åŒ–ï¼Œæµè§ˆå™¨æš‚æ—¶ä¸æ”¯æŒ
- ES6è¯­æ³•ï¼Œæµè§ˆå™¨ä¸å®Œå…¨æ”¯æŒ 
- å‹ç¼©ä»£ç ï¼Œæ•´åˆä»£ç è®©ç½‘é¡µåŠ è½½æ›´å¿«

webpackã€babeléƒ½æ˜¯å°†ES6è½¬è¯‘çš„

babelæ˜¯å°†ESçš„é«˜çº§è¯­æ³•å‘ä½çº§è¯­æ³•è½¬å˜çš„ä¸€ä¸ªå·¥å…·

webpackæ˜¯ä¸€ä¸ªæ‰“åŒ…çš„å·¥å…·

##### 2ã€babelåŸºç¡€æ’ä»¶çš„åŠŸèƒ½å’ŒåŒºåˆ«

å®‰è£…æ’ä»¶

- `babel-loader`åªæ˜¯babelæä¾›ä¸ªwebpackçš„ä¸€ä¸ªæ’ä»¶ï¼Œæ•´æ•´å»åšES6åˆ°ES5è½¬è¯‘çš„æ˜¯babele-coreè¿™ä¸ªæ ¸å¿ƒ
- `babel-core`å®šä¹‰äº†æµè§ˆå™¨ä¸€äº›å¯èƒ½ä¸å…¼å®¹çš„è¯­æ³•
- `babel/preset-env` babelåªè½¬åŒ–ä¸å…¼å®¹çš„è¯­æ³•ï¼Œä¸è½¬åŒ–æ–°çš„APIã€‚è¯­æ³•æŒ‡çš„æ˜¯æ¯”å¦‚ç®­å¤´å‡½æ•°ç­‰ç­‰ï¼ŒAPIæŒ‡çš„æ˜¯æ¯”å¦‚Promiseã€Setç­‰ç­‰æ–°çš„API
- `babel/pollyfill`ç±»ä¼¼äºè¡¥ä¸åŒ…ï¼Œæä¾›æ–°çš„APIçš„è½¬åŒ–

##### 3ã€åŸºç¡€é…ç½®ï¼ˆä¸»è¦æ˜¯styleç­‰çš„loaderç­‰ï¼‰

```shell
/**
 * webpacké…ç½®è¦å‘å¤–æš´éœ²ä¸€ä¸ªå¯¹è±¡ï¼Œç”¨commonjsçš„è§„èŒƒè¿›è¡Œï¼Œå› ä¸ºwebpackå†…éƒ¨æ˜¯åŸºäºnodeæ¥è¿›è¡Œçš„å¤„ç†
 */

const path = require('path'); 
const HtmlWebpackPlugin = require('html-webpack-plugin')
const CleanWebpackPlugin = require('clean-webpack-plugin')
const MiniCssExtracPlugin = require('mini-css-extract-plugin')
const webpack = require('webpack');
const { optimize } = require('webpack');
const OptimizeCssAssetsPlugin = require('optimize-css-assets-webpack-plugin');




function resolve(dir){          //ä¼ å…¥ä¸€ä¸ªç›®å½•åç§°ï¼Œå°±è¿”å›å½“å‰ç›®å½•åç§°æ‰€åœ¨çš„ç»å¯¹è·¯å¾„

    return path.resolve(__dirname,dir)
}

module.exports = {
    //æ¨¡å¼
    mode:'production',
    //å…¥å£:å…¥å£å¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€å¯¹è±¡ã€æ•°ç»„ï¼Œéƒ½æ˜¯å¯ä»¥çš„ 
    entry:{
        main:resolve('src/index.js')
    },
    //å‡ºå£
    output:{
        path:resolve('dist'),
        filename:'bundle.js',
        publicPath:'/'          //è§£å†³å›¾ç‰‡è·¯å¾„é—®é¢˜ï¼›æ‰€æœ‰ç”Ÿæˆçš„URLé“¾æ¥å·¦ä¾§ç”¨/å¼€å¤´ï¼›å³ç›¸å¯¹è·¯å¾„
    },
    //æ¨¡å—åŠ è½½å™¨ï¼›æŒ‰ç…§é¡ºåºä»ä¸‹å¾€ä¸Šæ‰§è¡Œã€‚enforeå¯ä»¥æ”¹å˜è¿™ä¸ªé¡ºåº
    module:{
        rules:[
            {
                enforce:'pre',          //å‰ç½®loaderæœ€å…ˆæ‰§è¡Œ;pre:æœ€å…ˆæ‰§è¡Œï¼›post:æœ€åæ‰§è¡Œ
                test: /\.m?js$/,        
                include:resolve('src'), 
                loader:'eslint-loader',  
                options:{
                    formatter:'eslint-friendly-formatter'       //å‹å¥½æ ¼å¼åŒ–
                }
            },
            //å¤„ç†ES6åˆ°ES5
            {
                test: /\.m?js$/,                                    //æŒ‡å®šå¯¹å“ªäº›æ–‡ä»¶è¿›è¡Œå¤„ç†ï¼Œæ­£åˆ™
                exclude: /(node_modules|bower_components)/,         //ä¸åŒ…æ‹¬å“ªäº›æ–‡ä»¶
                include:resolve('src'),                                         //åŒ…æ‹¬å“ªäº›æ–‡ä»¶
                use:[                                               //ä½¿ç”¨ï¼›å¯ä»¥ä½¿ç”¨å¯¹è±¡ã€æ•°ç»„ï¼›å†™å¯¹è±¡åªæœ‰ ä¸€ä¸ªloaderï¼Œå¹¶ä¸”loaderè¿˜æœ‰é…ç½®ä»¥åŠæŒ‡å®šä¸€äº›é¢å¤–ä¿¡æ¯ï¼›å¯¹è±¡æ˜¯æ•°ç»„çš„ç®€å†™ï¼Œæ•°ç»„ä¸­å¯ä»¥æœ‰ä»»æ„å¤šçš„loaderï¼Œä½†æ˜¯æ•°ç»„è¿™ç§æ–¹å¼ä¸å¯ä»¥å†™é…ç½®
                    {                                              
                        loader: 'babel-loader',                     //babelä¹Ÿå¯ä»¥ä¸“é—¨ç”¨é…ç½®æ–‡ä»¶babel.config.jsæˆ–è€….babelrcè¿›è¡Œé…ç½®ï¼Œä¹Ÿå¯ä»¥è¿™ä¸¤ä¸ªé…ç½®æ–‡ä»¶éƒ½ä¸å±‘ç›´æ¥åœ¨wbpackçš„è¿™ä¸ªåœ°æ–¹è¿›è¡Œé…ç½®å³å¯
                        // options: {
                        //     presets: ['@babel/preset-env']       //è¿™è¾¹çš„é…ç½®ä¹Ÿå¯ä»¥åœ¨babel.config.jsä¸­å†™
                        // }
                    }
                ]                                                
                
            },{
                //å¤„ç†å›¾ç‰‡
                test: /\.(jpe?g|png|webp|gif)$/,                                    //æŒ‡å®šå¯¹å“ªäº›æ–‡ä»¶è¿›è¡Œå¤„ç†ï¼Œæ­£åˆ™
                use:[                                               //ä½¿ç”¨ï¼›å¯ä»¥ä½¿ç”¨å¯¹è±¡ã€æ•°ç»„ï¼›å†™å¯¹è±¡åªæœ‰ ä¸€ä¸ªloaderï¼Œå¹¶ä¸”loaderè¿˜æœ‰é…ç½®ä»¥åŠæŒ‡å®šä¸€äº›é¢å¤–ä¿¡æ¯ï¼›å¯¹è±¡æ˜¯æ•°ç»„çš„ç®€å†™ï¼Œæ•°ç»„ä¸­å¯ä»¥æœ‰ä»»æ„å¤šçš„loaderï¼Œä½†æ˜¯æ•°ç»„è¿™ç§æ–¹å¼ä¸å¯ä»¥å†™é…ç½®
                    {                                              
                        loader: 'url-loader',                     //babelä¹Ÿå¯ä»¥ä¸“é—¨ç”¨é…ç½®æ–‡ä»¶babel.config.jsæˆ–è€….babelrcè¿›è¡Œé…ç½®ï¼Œä¹Ÿå¯ä»¥è¿™ä¸¤ä¸ªé…ç½®æ–‡ä»¶éƒ½ä¸å±‘ç›´æ¥åœ¨wbpackçš„è¿™ä¸ªåœ°æ–¹è¿›è¡Œé…ç½®å³å¯ã€‚å¤„ç†å›¾ç‰‡ã€å­—ä½“ã€éŸ³è§†é¢‘ç­‰
                        options: {
                            limit: 1024*15,                         //æŠŠå°äº15kbçš„è¿›è¡Œbase64å¤„ç†
                            name:'img/[name].[ext]'                 //æ–‡ä»¶è·¯å¾„ï¼›ç›¸å¯¹äºæ‰€æœ‰æ–‡ä»¶ä¸‹é¢çš„ï¼›[name]æ–‡ä»¶å[ext]åç¼€æ‰©å±•å
                        }
                    }
                ]      
            }, 
            //å¤„ç†css
            {
                test: /\.css$/,                                    //æŒ‡å®šå¯¹å“ªäº›æ–‡ä»¶è¿›è¡Œå¤„ç†ï¼Œæ­£åˆ™
                exclude: /(node_modules|bower_components)/,         //ä¸åŒ…æ‹¬å“ªäº›æ–‡ä»¶
                include:resolve('src'),                                         //åŒ…æ‹¬å“ªäº›æ–‡ä»¶
                use:[                                               //ä½¿ç”¨ï¼›å¯ä»¥ä½¿ç”¨å¯¹è±¡ã€æ•°ç»„ï¼›å†™å¯¹è±¡åªæœ‰ ä¸€ä¸ªloaderï¼Œå¹¶ä¸”loaderè¿˜æœ‰é…ç½®ä»¥åŠæŒ‡å®šä¸€äº›é¢å¤–ä¿¡æ¯ï¼›å¯¹è±¡æ˜¯æ•°ç»„çš„ç®€å†™ï¼Œæ•°ç»„ä¸­å¯ä»¥æœ‰ä»»æ„å¤šçš„loaderï¼Œä½†æ˜¯æ•°ç»„è¿™ç§æ–¹å¼ä¸å¯ä»¥å†™é…ç½®
                    MiniCssExtracPlugin.loader,         //ä»£æ›¿style-loader
                    // 'style-loader',             //style-loaderå°†jsä¸­çš„cssæ”¾åˆ°styleæ ‡ç­¾ä¸­å»      é…ç½®å¤šä¸ªloaderæ•´ä½“çš„é¡ºåºæ˜¯ä»ä¸‹å¾€ä¸Šï¼Œä»å³å¾€å·¦ã€‚æ‰€ä»¥åº”è¯¥æ˜¯css-loaderæ”¾åœ¨style-loaderçš„ä¸‹é¢
                    'css-loader',                //css-loaderå°†csså†…å®¹æ‰“åŒ…åˆ°jsä¸­å»
                    'postcss-loader',           //é¢„å¤„ç†cssçš„ï¼Œè¦åœ¨csså‰è¿›è¡Œï¼Œå› æ­¤ç”±äºloaderåŠ è½½é¡ºåºï¼Œæ”¾åœ¨css-loaderçš„ä¸‹é¢æˆ–è€…å³è¾¹

                ]                                                
                
            },
            //å¤„ç†less
            {
                test: /\.less$/,                                    //æŒ‡å®šå¯¹å“ªäº›æ–‡ä»¶è¿›è¡Œå¤„ç†ï¼Œæ­£åˆ™
                exclude: /(node_modules|bower_components)/,         //ä¸åŒ…æ‹¬å“ªäº›æ–‡ä»¶
                include:resolve('src'),                                         //åŒ…æ‹¬å“ªäº›æ–‡ä»¶
                use:[                                               //ä½¿ç”¨ï¼›å¯ä»¥ä½¿ç”¨å¯¹è±¡ã€æ•°ç»„ï¼›å†™å¯¹è±¡åªæœ‰ ä¸€ä¸ªloaderï¼Œå¹¶ä¸”loaderè¿˜æœ‰é…ç½®ä»¥åŠæŒ‡å®šä¸€äº›é¢å¤–ä¿¡æ¯ï¼›å¯¹è±¡æ˜¯æ•°ç»„çš„ç®€å†™ï¼Œæ•°ç»„ä¸­å¯ä»¥æœ‰ä»»æ„å¤šçš„loaderï¼Œä½†æ˜¯æ•°ç»„è¿™ç§æ–¹å¼ä¸å¯ä»¥å†™é…ç½®
                    MiniCssExtracPlugin.loader,         //ä»£æ›¿style-loader
                    // 'style-loader',             //style-loaderå°†jsä¸­çš„cssæ”¾åˆ°styleæ ‡ç­¾ä¸­å»      é…ç½®å¤šä¸ªloaderæ•´ä½“çš„é¡ºåºæ˜¯ä»ä¸‹å¾€ä¸Šï¼Œä»å³å¾€å·¦ã€‚æ‰€ä»¥åº”è¯¥æ˜¯css-loaderæ”¾åœ¨style-loaderçš„ä¸‹é¢
                    'css-loader',               //css-loaderå°†csså†…å®¹æ‰“åŒ…åˆ°jsä¸­å»
                    'postcss-loader',
                    'less-loader',
                ]                                                
                
            },
            //å¤„ç†stylus
            {
                test: /\.(styl|stylus)$/,                                    //æŒ‡å®šå¯¹å“ªäº›æ–‡ä»¶è¿›è¡Œå¤„ç†ï¼Œæ­£åˆ™
                exclude: /(node_modules|bower_components)/,         //ä¸åŒ…æ‹¬å“ªäº›æ–‡ä»¶
                include:resolve('src'),                                         //åŒ…æ‹¬å“ªäº›æ–‡ä»¶
                use:[                                               //ä½¿ç”¨ï¼›å¯ä»¥ä½¿ç”¨å¯¹è±¡ã€æ•°ç»„ï¼›å†™å¯¹è±¡åªæœ‰ ä¸€ä¸ªloaderï¼Œå¹¶ä¸”loaderè¿˜æœ‰é…ç½®ä»¥åŠæŒ‡å®šä¸€äº›é¢å¤–ä¿¡æ¯ï¼›å¯¹è±¡æ˜¯æ•°ç»„çš„ç®€å†™ï¼Œæ•°ç»„ä¸­å¯ä»¥æœ‰ä»»æ„å¤šçš„loaderï¼Œä½†æ˜¯æ•°ç»„è¿™ç§æ–¹å¼ä¸å¯ä»¥å†™é…ç½®
                    MiniCssExtracPlugin.loader,
                    // 'style-loader',             //style-loaderå°†jsä¸­çš„cssæ”¾åˆ°styleæ ‡ç­¾ä¸­å»      é…ç½®å¤šä¸ªloaderæ•´ä½“çš„é¡ºåºæ˜¯ä»ä¸‹å¾€ä¸Šï¼Œä»å³å¾€å·¦ã€‚æ‰€ä»¥åº”è¯¥æ˜¯css-loaderæ”¾åœ¨style-loaderçš„ä¸‹é¢
                    'css-loader',               //css-loaderå°†csså†…å®¹æ‰“åŒ…åˆ°jsä¸­å»
                    'postcss-loader',
                    'stylus-loader'
                ]                                                
                
            }
        ]
    },
    //æ’ä»¶
    plugins:[
        //å‘é¡µé¢ä¸­å¼•å…¥æ‰“åŒ…çš„jsæˆ–è€…cssä»£ç 
        new HtmlWebpackPlugin({
            template:'public/index.html'           //æŒ‡å®šä»¥å“ªä¸ªä¸ºæ¨¡æ¿
        }),

        //æ¸…é™¤æ‰“åŒ…æ–‡ä»¶å¤¹
        new CleanWebpackPlugin(['dist']),
        // new webpack.ProvidePlugin({
        //     jQuery: "jquery",           //é…ç½®jquery
        //     $: "jquery" 
        // }) 

        
        //ä»jsä¸­æŠ½å–csså•ç‹¬æ‰“åŒ…;ä¸€æ—¦æŠ½å–äº†csså°±ä¸éœ€è¦cssloaderäº†ï¼Œéœ€è¦æ¢æˆè¿™ä¸ªæ’ä»¶é‡Œé¢çš„loaderã€‚å•ç‹¬æ‰“åŒ…css
        new MiniCssExtracPlugin({
            filename:'css/[name].css'
        }),

        
    ],

    //å¼€å‘æœåŠ¡å™¨
    devServer:{
        open:true   //è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨è®¿é—®
    },


    //ä¼˜åŒ–é…ç½®
    optimization:{
        minimizer:[new OptimizeCssAssetsPlugin()]
    }

}
```



## 7.19

#### 4ã€cssä¼ªç±»å®ç°ä¸‰è§’å½¢

```shell
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        
	div{
		position:relative;
		width:100px;
		height:50px;
		margin:100px auto;
		box-shadow:0 0 2px green;
	}	
    div:before{
		content:"";
		position:absolute;
		left: 100px;
        top: 15px;
		border-bottom:10px solid transparent;
		border-left:10px solid green;
		border-top:10px solid transparent;
	}
   

    </style>
</head>
<body>
    <div></div>
    
</body>
</html>
```

#### 5ã€ä»€ä¹ˆæ˜¯é«˜é˜¶ç»„ä»¶ï¼Ÿä»¥åŠé«˜é˜¶ç»„ä»¶çš„ä½¿ç”¨ã€‚é«˜é˜¶ç»„ä»¶&é«˜é˜¶å‡½æ•°

`é«˜é˜¶ç»„ä»¶`æ˜¯ä¼ å…¥ä¸€ä¸ªç»„ä»¶ï¼Œè¿”å›ä¸€ä¸ªç»„ä»¶ã€‚

`connect` æ˜¯ä¸€ä¸ªè¿”å›é«˜é˜¶ç»„ä»¶çš„é«˜é˜¶å‡½æ•°ã€‚æ¥æ”¶ç»„ä»¶ï¼Œäº§å‡ºä¸€ä¸ªè¢«ProvideråŒ…è£¹çš„ç»„ä»¶



#### 6ã€Reactç”Ÿå‘½å‘¨æœŸ

æŒ‚è½½ä¸­mounting

componentWillmount

componentDidMount

æ›´æ–°ä¸­updating

- componentWillReceiveProps

- componentWillUpdate

- componentDidUpdate
- shouldComponentUpdate

æ›´æ–°å®Œæˆunmounting

- componentDidUnmount

#### 7ã€setStateåŒæ­¥è¿˜æ˜¯å¼‚æ­¥ï¼Ÿä¸ºä»€ä¹ˆä¼šæœ‰è¿™ç§æƒ…å†µäº§ç”Ÿï¼Ÿ

å¼‚æ­¥ï¼Œç”±äºè€ƒè™‘æ€§èƒ½åŸå› ï¼Œreactä¼šå°†å¤šä¸ªstateçš„æ“ä½œåˆå¹¶ï¼Œæ‰€ä»¥å¦‚æœè¦æ˜¯å¯¹stateè¿›è¡Œå¤šæ¬¡çš„setStateæ“ä½œçš„è¯ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¼šè¿›è¡ŒObject.assignæ“ä½œå°†å¤šä¸ªæ“ä½œåˆå¹¶åˆ°ä¸€èµ·çš„ã€‚æ‰€ä»¥ï¼Œå¦‚æœæ˜¯è¦é˜²æ­¢è¿™ç§æƒ…å†µäº§ç”Ÿï¼Œå¯ä»¥ä½¿ç”¨ä¼ å…¥å‡½æ•°çš„æ–¹æ³•è¿›è¡Œstateçš„è®¾ç½®ï¼Œä»¥åŠä½¿ç”¨callbackå›è°ƒå‡½æ•°çš„æ–¹æ³•ï¼Œæ‹¿åˆ°ä¿®æ”¹åçš„å€¼ã€‚

- setStateæ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥å¤„ç†
  - å¼‚æ­¥å¤„ç†ï¼Œå¤šæ¬¡setStateçš„æ—¶å€™ï¼Œä»–ä»¬ä¼šå°†setStateæ“ä½œåˆå¹¶æˆä¸€æ¬¡è¿›è¡Œå¤„ç†ã€‚å³ä¼šå¯¹å…¶æƒŠé†’Object.assignæ“ä½œå¤„ç†

- ä¸ºä»€ä¹ˆsetStateè¦è®¾è®¡æˆå¼‚æ­¥
  - æ€§èƒ½ä¼˜åŒ–ï¼Œå¤šæ¬¡æ“ä½œåˆå¹¶æˆä¸€æ¬¡æœ‰åˆ©äºæé«˜æ€§èƒ½

- setStateé™¤äº†å¯ä»¥æ¥å—ä¸€ä¸ªå¯¹è±¡ä¹‹å¤–è¿˜å¯ä»¥æ¥æ”¶ä¸€ä¸ªå‡½æ•°

```shell
this.setState((state)=>{
  return {count:state.count+1}
})
```

- setStateä¼ å…¥çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯å›è°ƒå‡½æ•°ï¼Œå¯ä»¥åœ¨è¿™é‡Œé¢è·å–stateå°±æ˜¯æ›´æ–°åçš„state

#### 8ã€react diffæœ‰æ²¡æœ‰äº†è§£è¿‡

[react diff](https://zhuanlan.zhihu.com/p/20346379)

reactçš„diffç®—æ³•ä¼šå¸®æˆ‘ä»¬è®¡ç®—å‡ºè™šæ‹Ÿdomä¸­çœŸæ­£å˜åŒ–çš„éƒ¨åˆ†ï¼Œå¹¶ä¸”åªé’ˆå¯¹è¯¥éƒ¨åˆ†è¿›è¡Œå®é™…çš„domæ“ä½œï¼Œè€Œå¹¶éé‡æ–°æ¸²æŸ“æ•´ä¸ªé¡µé¢ã€‚

##### diffç­–ç•¥

- Tree diff:è·¨å±‚çº§domæ“ä½œï¼šweb UIä¸­è·¨å±‚çº§çš„domæ“ä½œæ¯”è¾ƒå°‘ï¼Œå¯ä»¥å¿½ç•¥ä¸è®¡ã€‚
  - æ ‘è¿›è¡Œåˆ†å±‚æ¯”è¾ƒï¼Œä¸¤æ£µæ ‘åªä¼šå¯¹åŒä¸€å±‚æ¬¡çš„èŠ‚ç‚¹è¿›è¡Œæ¯”è¾ƒ
  - **å‡ºç°äº†è·¨å±‚çº§çš„æ€ä¹ˆåŠï¼Ÿ**è·¨å±‚çº§çš„ä¸ä¼šè·¨å±‚çº§ç§»åŠ¨ï¼Œåªä¼šæ•´ä¸ªåˆ é™¤å¹¶ä¸”é‡å»ºï¼ˆååˆ†å½±å“æ€§èƒ½ï¼Œå› æ­¤å®˜æ–¹å¹¶ä¸æ¨èè·¨å±‚çº§æ“ä½œï¼‰
- Component diff:æ ‘å½¢ç»“æ„ï¼šæ‹¥æœ‰ç›¸åŒç±»çš„ä¸¤ä¸ªç»„ä»¶ä¼šç”Ÿæˆç›¸ä¼¼çš„æ ‘å½¢ç»“æ„ï¼Œæ‹¥æœ‰ä¸åŒç±»çš„ä¸¤ä¸ªç»„ä»¶ä¼šç”Ÿæˆä¸åŒçš„æ ‘å½¢ç»“æ„
  - åŒä¸€ç±»å‹çš„ç»„ä»¶ï¼Œç»§ç»­æŒ‰ç…§diffç­–ç•¥è¿›è¡Œæ¯”è¾ƒ
  - å¦‚æœä¸æ˜¯åŒä¸€ç±»å‹çš„ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šè¢«åˆ¤å®šä¸ºdirty componentï¼Œä»è€Œæ›¿æ¢æ•´ä¸ªç»„ä»¶ä¸‹çš„æ‰€æœ‰å­èŠ‚ç‚¹
  - å¯¹äºåŒä¸€ç±»å‹çš„ç»„ä»¶ï¼Œå¯èƒ½å®ƒçš„è™šæ‹Ÿdomæ²¡æœ‰ä»»ä½•çš„å˜åŒ–ã€‚å¦‚æœèƒ½ç¡®åˆ‡çŸ¥é“è¿™ç‚¹ï¼Œé‚£ä¹ˆå¯ä»¥èŠ‚çœå¤§é‡çš„diffè¿ç®—æ—¶é—´ï¼Œå› æ­¤reactå…è®¸ç”¨æˆ·é€šè¿‡shouldComponentUpdateæ¥åˆ¤æ–­è¿™ä¸ªç»„ä»¶æ˜¯å¦éœ€è¦è¢«update
- Element diff:åŒå±‚çº§idåŒºåˆ†ï¼šå¯¹äºåŒä¸€å±‚çº§çš„ä¸€ç»„èŠ‚ç‚¹ï¼Œä»–ä»¬å¯ä»¥é€šè¿‡å”¯ä¸€çš„idè¿›è¡ŒåŒºåˆ†
  - å½“å¤„äºåŒä¸€å±‚çº§çš„æ—¶å€™ï¼Œreactæä¾›äº†ä¸‰ç§æ“ä½œï¼Œinsertã€moveã€removeã€‚æ’å…¥ã€ç§»åŠ¨ã€åˆ é™¤ä¸‰ç§æ“ä½œã€‚
  - **ä¸ºä»€ä¹ˆè¦è®¾ç½®keyï¼Ÿ**å› ä¸ºåŒä¸€çº§åˆ«å…ƒç´ ï¼Œå¦‚æœä¸è®¾ç½®keyçš„è¯ï¼Œå¦‚æœå°†å…ƒç´ çš„ä½ç½®è¿›è¡Œäº†ç§»åŠ¨ï¼Œä¼šå°†å…ƒç´ è¿›è¡Œåˆ é™¤é‡å»ºå·¥ä½œï¼Œå¦‚æœè®¾ç½®äº†keyçš„è¯å°±åªæ˜¯removeçš„ç§»åŠ¨æ“ä½œã€‚ç›¸è¾ƒäºè€Œè¨€çš„è¯ï¼Œç§»åŠ¨æ“ä½œçš„æ€§èƒ½æ¯”åˆ é™¤é‡å»ºé«˜å¾ˆå¤šã€‚

#### 9ã€React fiberæ˜¯ä»€ä¹ˆï¼Ÿæœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿ

[React Fiber](https://developer.aliyun.com/article/782946)

[React Fiber](https://zhuanlan.zhihu.com/p/26027085)ï¼Œè¿™ç¯‡æ–‡ç« è™½ç„¶æ¯”è¾ƒä¹…ï¼Œä½†æ˜¯ååˆ†é€šä¿—æ˜“æ‡‚ã€‚

React Fiberä¸­ä¸€æ¬¡æ›´æ–°ä¼šåˆ†æˆå¤šæ¬¡åˆ†ç‰‡è¿›è¡Œã€‚React Fiberæ˜¯Reactå¼€å‘å›¢é˜Ÿä¸ºäº†æé«˜reactçš„æ€§èƒ½ï¼Œè§£å†³ç”±äºjså•çº¿ç¨‹ï¼Œå¹¶ä¸”æ¸²æŸ“çº¿ç¨‹å’Œjsæ‰§è¡Œçº¿ç¨‹å…±ç”¨åŒä¸€ä¸ªçº¿ç¨‹ï¼Œå¯¼è‡´çš„ç”±äºreact diffç­‰è¿‡ç¨‹é€ æˆçš„é¡µé¢å¡é¡¿çš„é—®é¢˜ã€‚å› æ­¤ï¼Œreactä»æ—¶é—´ç»´åº¦ä¸Šè¿›è¡Œäº†åˆ†ç‰‡å¤„ç†ï¼Œå°†diffæ“ä½œå³reconcilationï¼ˆåè°ƒï¼‰è¿™ä¸ªè¿‡ç¨‹æ‹†åˆ†æˆå°çš„ä»»åŠ¡ã€‚é€šè¿‡åˆç†çš„æœºåˆ¶æ¥è°ƒåº¦æ—¶é—´ï¼Œè®©reconcilationè¿™ä¸ªè¿‡ç¨‹å˜æˆå¯æ§å¯ä¸­æ–­çš„ã€‚é€‚æ—¶åœ°äº¤å‡ºCPUçš„ä½¿ç”¨æƒé™ï¼Œè®©æµè§ˆå™¨åŠæ—¶åœ°è·Ÿç”¨æˆ·è¿›è¡Œäº¤äº’ã€‚fiberçš„æŸ¥åˆ†å•ä½æ˜¯fiber treeä¹Ÿå°±æ˜¯æŒ‰ç…§è™šæ‹Ÿçš„domèŠ‚ç‚¹è¿›è¡ŒæŸ¥åˆ†çš„ï¼Œå®ƒçš„å®ç°å®é™…ä¸Šæ˜¯ä½¿ç”¨é“¾è¡¨å»å®ç°çš„ã€‚

#### 10ã€å¹³å¸¸ä½¿ç”¨è¿‡React Hookäº†å—ï¼Ÿå®ƒè·Ÿreact classæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿè¯·ç®€è¦ä»‹ç»ä¸€ä¸‹

ï¼ˆhooksè¿˜æ˜¯å¾ˆæœ‰æ„æ€ï¼Œä¹‹åæœ‰å¿…è¦å†™ä¸ªdemoå…·ä½“ä½¿ç”¨ä¸€ä¸‹ï¼‰

##### ç»„ä»¶ä¹‹é—´å¤ç”¨çŠ¶æ€é€»è¾‘å¾ˆå›°éš¾

æ¯”å¦‚å¤ç”¨åŒä¸€ä¸ªç»„ä»¶çš„æ—¶å€™ç”±äºåˆ¤æ–­çŠ¶æ€é€»è¾‘ç­‰çš„ä¸ä¸€è‡´ï¼Œä¼šåœ¨ç”Ÿå‘½å‘¨æœŸä¸­å†™å¤§é‡ä¸æƒ³ç®¡çš„ä»£ç ï¼Œå¯¼è‡´ç»„ä»¶å¤æ‚

## 7.20

#### 11ã€æ‰‹å†™newçš„å®ç°

```shell
var p = _new(Person,'aaa')

function _new(Fn,...args){	//Fnæ˜¯å½“å‰è¦newçš„ç±»
  var obj = new Object();
  obj.__proto__ = Fn.prototype;
  Fn.call(obj,...args)
  return obj;
}
```

#### 12ã€æ‰‹å†™PromiseåŠ è½½ä¸€å¼ å›¾ç‰‡

```shell
function loadImg(url){
  return new Promise((resolved,rejected)=>{
    let img = document.createElement('img')
    img.onload(function(){
      console.log('loaded')
      resolved(url)
    })
    img.onerror(function(){
      console.log('error')
      rejected(new Error('å›¾ç‰‡åŠ è½½å¤±è´¥'))
    })
    img.src = url;
  })
}

loadImg('http://...').then((res)=>{
  console.log(res)
})
```

#### 13ã€Promiseç›¸å…³é¢˜ç›®

##### ã€reã€‘é¢˜ç›®è¾“å‡º

```shell
const first = () =>(new Promise((resolve,reject)=>{
    console.log(3)
    let p = new Promise((resolve,reject)=>{
      console.log(7)
      setTimeout(()=>{
        console.log(5)
        resolve(6)		//ä¸€ä¸ªpromiseå€¼èƒ½æ‰§è¡Œä¸€ä¸ªresolveï¼›è¿™ä¸ªåœ¨å®šæ—¶å™¨ä¸­ï¼Œæ¯”ä¸‹é¢åæ‰§è¡Œï¼Œå› æ­¤æ˜¯æ‰§è¡Œä¸‹é¢çš„
      },0)
      resolve(1)
    })
    resolve(2)
    p.then((arg)=>{
      console.log(arg)
    })
  }))
  
  first().then((arg)=>{
    console.log(arg)
  })
  console.log(4)
  
  //3 7 4 1 2 5
```

##### å¦‚ä½•å®ç°é“¾å¼è°ƒç”¨ï¼Ÿ

æ¯”å¦‚å®ç°ï¼š`b.then().then().then()`

- thenæ–¹æ³•ï¼šè¿”å›è¿™ä¸ªå¯¹è±¡å®ä¾‹
- thenæ–¹æ³•ï¼šè¿”å›this

```shell
class Test{
  then(){
  	console.log('test')
    return this;
  }
}

class Test1{
  then(){
  	console.log('test1')
    return new Test();
  }
}
```

##### æ‰‹å†™Promiseçš„å®ç°ï¼ˆthençš„é“¾å¼è°ƒç”¨ï¼‰

promiseç‰¹ç‚¹åˆ†æï¼š

- Promiseå‚æ•°å‡½æ•°ä¼šç«‹å³æ‰§è¡Œ
- promiseåœ¨thençš„å›è°ƒå‡½æ•°ä¸­å¯ä»¥æ‹¿åˆ°resolveçš„å€¼
- promiseå¯ä»¥æœ‰å¤šä¸ªthenå¹¶ä¸”ä¾æ¬¡é“¾å¼è°ƒç”¨æ‰§è¡Œ
- promiseå¯ä»¥åµŒå¥—å¤šä¸ªthenï¼Œå¹¶ä¸”thenä¸­ä¹Ÿæ˜¯å¯ä»¥è¿”å›Promise
- resolvedçŠ¶æ€çš„promiseè°ƒç”¨thenä¼šç«‹å³æ‰§è¡Œ
- äºŒæ¬¡è°ƒç”¨resolveä¸ä¼šäº§ç”Ÿå½±å“

å®ç°æ€è·¯

- promiseæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä¸€èˆ¬é€šè¿‡newè¿›è¡Œå®ä¾‹åŒ–
- promiseçš„thenæ˜¯å¯ä»¥é“¾å¼è°ƒç”¨çš„ï¼Œå› æ­¤è¦æœ‰thençš„é“¾å¼è°ƒç”¨çš„å®ç°
- æ ¹æ®åˆ—å‡ºçš„ç‰¹å®šå®ç°
- å®ç°Promiseçš„æ„é€ æ–¹æ³•å’Œthenæ–¹æ³•

```shell
let State = {
  pending:'pending',
  resolved:'resolved',
  rejected:'rejected'
}

const noop = () => {}

class myPromise{
  constructor(exclutor){
    exclutor(this._resolve.bind(this),this._reject.bind(this))		//Promiseå›è°ƒå‡½æ•°ç«‹å³æ‰§è¡Œ
  }
  _state = State.pending;
  _value;
  
  _resolve(val){
    this._val = val;
    this._state = State.resolved;
    //å¦‚æœæ˜¯resolvedå°±å»æ‰§è¡Œthenä¸­ä¼ å…¥çš„å›è°ƒæ–¹æ³•ï¼Œå¹¶ä¸”å°†resolveè¿”å›å€¼ç»™å®ƒ
    while(_resArr.length !== 0){	
      const item = _resArr.shift()
      item(this._val)
    }
  }
  _reject(){
    this._state = State.rejected;
  }
  
  _resArr = []
  then(onRes,onRej = noloop){
    const newPromise = new MyPromise(()=>{})
    this._resArr.push(onRes)
    return newPromise;		//è¿”å›Promiseå®ç°é“¾å¼å›è°ƒ
  }
}
```

#### 14ã€é—­åŒ…

##### é—­åŒ…çš„ä¸¤å¤§ä½œç”¨

- ä¿æŠ¤
- ä¿å­˜

##### é—­åŒ…åœ¨å“ªäº›åœ°æ–¹åº”ç”¨åˆ°äº†ï¼Ÿ

- bindå‡½æ•°

```shell
(function(){
  function mybind(context=window,...args){
    let _this = this;
    return function(...innerArgs){
      _this.call(context,...innerArgs.concat(args))
    }
  }
  Function.prototype.mybind = mybind;
}()

let obj = {
  name:'smileyqp'
}
document.body.onclick = fn.mybind(obj,100,200)
```

- å‡½æ•°çš„æŸ¯é‡ŒåŒ–ï¼šä¹Ÿå°±æ˜¯åº”ç”¨é—­åŒ…çš„æ€æƒ³ã€‚å‡½æ•°çš„æŸ¯é‡ŒåŒ–ä¹Ÿå°±æ˜¯é¢„å¤„ç†ã€‚æœ€ç®€å•çš„å‡½æ•°æŸ¯é‡ŒåŒ–çš„demoï¼š

```shell
function fn(a){
  return function(b){
    return a+b
  }
}
fn(1)(2)
```

- éå†ï¼šå®šæ—¶å™¨ä¸­æ‰“å°éå†çš„index

- åšä¸€ä¸ªcacheå·¥å…·ï¼šåªå¯¹å¤–æä¾›apiè¿›è¡Œæ•°æ®æ“ä½œï¼Œä¸èƒ½ç›´æ¥å¯¹æ•°æ®è¿›è¡Œæ“ä½œ

```shell
function createCache(){
	const data = {}	//é—­åŒ…ä¸­çš„æ•°æ®ï¼Œè¢«éšè—
  return {
    set:(key,val){
      data[key] = val;
    },
    get:(key){
      return date[key]
    }
  }
}

```

#### 15ã€httpsçš„sslè®¤è¯è¿‡ç¨‹

[sslè®¤è¯è¿‡ç¨‹](https://xie.infoq.cn/article/e021a8389f783e65d46149cc8)

![](https://static001.geekbang.org/infoq/4b/4bfc6b00464470c92d59c8d5df3003c5.png)

- å®¢æˆ·ç«¯è®¿é—®httpsé“¾æ¥
- æœåŠ¡ç«¯å‘é€å…¬é’¥ï¼ˆè¯ä¹¦ï¼‰ç»™å®¢æˆ·ç«¯
- å®¢æˆ·ç«¯éªŒè¯æœåŠ¡ç«¯çš„è¯ä¹¦
  - æ˜¯å¦åˆæ³•ã€æ˜¯å¦è¿‡æœŸ
  - å®¢æˆ·ç«¯ç”Ÿæˆéšæœºå­—ç¬¦ä¸²ï¼Œå¹¶ä¸”ç”¨æœåŠ¡ç«¯å‘é€è¿‡æ¥çš„å…¬é’¥è¿›è¡ŒåŠ å¯†
- æœåŠ¡ç«¯æ¥æ”¶åŠ å¯†ä¿¡æ¯ï¼Œå¹¶ä¸”ç”¨ç§é’¥è§£å¯†éšæœºæ•°ï¼Œé€šè¿‡ä¼ å…¥éšæœºæ•°çš„å¯¹ç§°åŠ å¯†å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†
- æœåŠ¡å™¨å‘å®¢æˆ·ç«¯ä¼ è¾“å¯¹ç§°åŠ å¯†åçš„å†…å®¹
- å®¢æˆ·ç«¯æ ¹æ®å®¶æœ¬åœ°å­˜å‚¨çš„éšæœºæ•°è¿›è¡Œè§£å¯†





##### 7.20ç¬¬ä¸€æœŸå®Œç»“æ’’èŠ±ğŸ‰ğŸ‰ğŸ‰å˜»å˜»å˜»ï¼Œæ¥ä¸‹æ¥çš„è¯åº”è¯¥æ˜¯å†ç³»ç»Ÿåœ°ä¸€ä¸ªç³»åˆ—reviewä»¥åŠstudyå•¦ï¼Fightingï¼





























